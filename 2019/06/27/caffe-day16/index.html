<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Day16 Caffe可视化方法 · 308实验室</title><meta name="description" content="Day16 Caffe可视化方法 - Kiyamou"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="308实验室"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="308实验室" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/circle.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/Kiyamou" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Day16 Caffe可视化方法</h1><div class="post-info">Jun 27, 2019</div><div class="post-content"><p>《21天实战Caffe》学习笔记第16天</p>
<h3 id="数据可视化"><a href="#数据可视化" class="headerlink" title="数据可视化"></a>数据可视化</h3><p>把书上的matlab代码敲出来即可，对mnist手写数字数据集和cifar10图片数据集的数据做可视化。</p>
<h3 id="模型可视化"><a href="#模型可视化" class="headerlink" title="模型可视化"></a>模型可视化</h3><h4 id="网络结构可视化"><a href="#网络结构可视化" class="headerlink" title="网络结构可视化"></a>网络结构可视化</h4><h5 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h5><p>用以下命令安装的python-devel，还是2.7版本的。（那我前面装python 3.7是白忙活了？）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install python-devel</span><br></pre></td></tr></table></figure>

<p>numpy和<code>/caffe/python/requirements.txt</code>清单里的包，均用pip3安装的。</p>
<p>安装时报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR: matplotlib 3.1.0 has requirement python-dateutil&gt;&#x3D;2.1, but you&#39;ll have python-dateutil 1.5 which is incompatible.</span><br><span class="line">ERROR: pandas 0.24.2 has requirement python-dateutil&gt;&#x3D;2.5.0, but you&#39;ll have python-dateutil 1.5 which is incompatible.</span><br></pre></td></tr></table></figure>

<p>因为清单里要求python-dateutil的版本不能大于2，所以出现上述问题。但只是不兼容，而上述三个包都装上了，所以先这样。</p>
<a id="more"></a>

<h5 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h5><p>不知道为什么，要重新编译一次caffe。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~&#x2F;caffe</span><br><span class="line">make clean</span><br><span class="line">make -j</span><br></pre></td></tr></table></figure>

<p>编译时报错。（我不记得之前编译有没有报错了）</p>
<p>改用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>

<p>编译通过。</p>
<p>编译pycaffe。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make pycaffe</span><br></pre></td></tr></table></figure>

<p>报错，找不到numpy名下的头文件。</p>
<p>（通过pip安装numpy还是没法直接用）</p>
<p>yum里<code>python-numpy</code>叫<code>numpy</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install numpy</span><br></pre></td></tr></table></figure>

<p>之后pycaffe编译成功。</p>
<h5 id="运行与画图"><a href="#运行与画图" class="headerlink" title="运行与画图"></a>运行与画图</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~&#x2F;caffe&#x2F;python</span><br><span class="line">python3 draw_net.py ..&#x2F;models&#x2F;bvlc_reference_caffenet&#x2F;train_val.prototxt caffenet.png</span><br></pre></td></tr></table></figure>

<p>不行，用<code>python</code>执行也不行，但报错信息不一样。</p>
<p>直接在命令行下调用python，测试</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> caffe</span><br></pre></td></tr></table></figure>

<p>无论是<code>python3</code>还是<code>python</code>，都不行，同样报错信息不一样。</p>
<p>（完蛋…）</p>
<h4 id="检查报错"><a href="#检查报错" class="headerlink" title="检查报错"></a>检查报错</h4><h5 id="报错内容"><a href="#报错内容" class="headerlink" title="报错内容"></a>报错内容</h5><p>用<code>python3</code>调用<code>draw_net.py</code>和控制台<code>import caffe</code>的报错都指向同一个问题，大概是“有冲突”？</p>
<p>用<code>python</code>调用上述两者似乎也是指向同一个问题，找不到<code>xxx.io</code>。</p>
<p>虽然caffe已经支持Python3，但从报错信息上看，似乎是用Python2更加靠谱一点。下面解决Pyhon2的报错。</p>
<h5 id="缺失的包"><a href="#缺失的包" class="headerlink" title="缺失的包"></a>缺失的包</h5><p>报错提示的缺失文件指向一个Python包，那个包我已经安装了。安装的时候我使用<code>pip3</code>安装的，看到报错后又用<code>pip</code>装了一次，但似乎对那个包没什么改动，倒是依赖的限制版本的python-dateutil给强制升级了。</p>
<p>装完了仍是同样的报错。</p>
<p>在Github的issue上有人说需要将<code>~/caffe/python</code>添加至环境变量，但我添加后仍是同样的报错。</p>
<p>而在stackoverflow上甚至有人在python脚本里写了<code>import ...</code>，但仍有同样的报错。</p>
<p>所以结论应该很明显了，类似numpy，即使用pip给python装了相应的包，也要用yum再装一次？</p>
<p>但无论是<code>...</code>还是<code>python-...</code>都找不到那个包…</p>
<p>而且官方教程中也仅有Ubuntu下的安装命令…</p>
<h4 id="换个思路"><a href="#换个思路" class="headerlink" title="换个思路"></a>换个思路</h4><h5 id="从编译文件入手"><a href="#从编译文件入手" class="headerlink" title="从编译文件入手"></a>从编译文件入手</h5><p>从caffe的编译文件<code>makefile.config</code>入手，看懂了<code>makefile.config</code>文件，发现在编译时忽略了对Python路径的依赖，而我又怕改路径改出乱子。所以根据<code>makefile.config</code>中的注释，将需要的文件复制到对应位置，使<code>makefile.config</code>的默认路径有效。</p>
<p>主要一点就是，默认路径指向<code>usr/lib</code>，而caffe编译所需的Pyhon相关文件，我这边是在<code>usr/lib64</code>里。</p>
<p>另外就Python包——site packages和dist packages的问题。</p>
<h5 id="重新安装依赖"><a href="#重新安装依赖" class="headerlink" title="重新安装依赖"></a>重新安装依赖</h5><p>解决了前述路径问题，自然要重新编译一次，然后也搞明白了目前的<code>pip</code>和<code>pip3</code>命令都指向Python3（这也回答了<a href="https://yimino.github.io/2019/06/27/g-cmake-python/" target="_blank" rel="noopener">https://yimino.github.io/2019/06/27/g-cmake-python/</a>的疑问），所以在安装了Python2的pip后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install python-pip</span><br></pre></td></tr></table></figure>

<p>重新安装其他依赖包。</p>
<p>在前面有不同包之间相互依赖，导致版本冲突的问题，所以这次按照<code>/caffe/python/requirements.txt</code>的内容，重写了<code>requirements.txt</code>，把里面的<code>&gt;=</code>改成<code>==</code>，能安装低版本就尽量安装低版本。</p>
<p>然后再编译caffe和pycaffe。</p>
<p>至此，<code>import caffe</code>终于正常了。</p>
<p>（虽然有个warning，但应该无伤大雅。）</p>
<h5 id="再次画图"><a href="#再次画图" class="headerlink" title="再次画图"></a>再次画图</h5><p>执行，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python draw_net.py ..&#x2F;models&#x2F;bvlc_reference_caffenet&#x2F;train_val.prototxt caffenet.png</span><br></pre></td></tr></table></figure>

<p>报错。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OSError: [Errno 2] &quot;dot&quot; not found in path.</span><br></pre></td></tr></table></figure>

<p>根据<a href="https://github.com/BVLC/caffe/issues/4911" target="_blank" rel="noopener">https://github.com/BVLC/caffe/issues/4911</a>，需要安装graphviz包。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install graphviz</span><br></pre></td></tr></table></figure>

<p>至此，<code>draw_net.py</code>脚本得以正常运行，网络结构图get！</p>
<h4 id="网络权值可视化"><a href="#网络权值可视化" class="headerlink" title="网络权值可视化"></a>网络权值可视化</h4><h5 id="安装Matlab"><a href="#安装Matlab" class="headerlink" title="安装Matlab"></a>安装Matlab</h5><p><strong>虚拟机复制文件的缓存</strong></p>
<p>首先解决一下主机与虚拟机之间复制文件的缓存问题。</p>
<p>从虚拟机向主机复制文件，缓存于Windows主机的<code>C:\Users\&quot;User Name&quot;\AppData\Local\Temp\vmware-&quot;User Name&quot;\VMwareDnD</code>中，直接删除即可。</p>
<p>从主机向虚拟机复制文件，缓存于Linux虚拟机的<code>/root/.cache/vmware/drag_and_drop</code>中，查看日期信息，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;root&#x2F;.cache&#x2F;vmware&#x2F;drag_and_drop</span><br><span class="line">ls -lht</span><br></pre></td></tr></table></figure>

<p>查看文件大小，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">du -h --max-depth&#x3D;0 &#x2F;root&#x2F;.cache&#x2F;vmware&#x2F;drag_and_drop&#x2F;*</span><br></pre></td></tr></table></figure>

<p>删除缓存。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf &#x2F;root&#x2F;.cache&#x2F;vmware&#x2F;drag_and_drop&#x2F;*</span><br></pre></td></tr></table></figure>

<p>（但我由主机向虚拟机复制文件后，虚拟机所在磁盘的容量似乎减少了复制文件大小的两倍，在清除虚拟机缓存后也是如此…是我的错觉吗…）</p>
<p><strong>安装过程</strong></p>
<p>（看安装包里的教程即可）</p>
<p>挂载iso。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t auto -o loop $PATH$&#x2F;R2018b_glnxa64_dvd1.iso &#x2F;mnt&#x2F;iso</span><br></pre></td></tr></table></figure>

<p>若提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount: &#x2F;dev&#x2F;loop0 is write-protected, mounting read-only</span><br></pre></td></tr></table></figure>

<p>则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;</span><br><span class="line">chmod 755 mnt</span><br></pre></td></tr></table></figure>

<p>挂载成功后，不要进入挂载目录，而是在随便的另外一个目录下执行安装命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;mnt&#x2F;iso&#x2F;install</span><br></pre></td></tr></table></figure>

<p>我这里提示了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp: cannot stat ‘&#x2F;mnt&#x2F;iso&#x2F;sys&#x2F;java&#x2F;jre&#x2F;glnxa64&#x2F;jre&#x2F;man&#x2F;ja_JP.UTF-8’: Input&#x2F;output error</span><br></pre></td></tr></table></figure>

<p>但似乎没发现什么问题。</p>
<p>然后即可进入图像安装界面，按提示操作即可。</p>
<h3 id="学习曲线"><a href="#学习曲线" class="headerlink" title="学习曲线"></a>学习曲线</h3><p>这个先放一放，之前用matlab神经网络工具箱时看过类似的曲线，而且又没有进一步理解曲线的经验和知识。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/06/28/caffe-day17/" class="prev">PREV</a><a href="/2019/06/15/av1-aom/" class="next">NEXT</a></div><div class="copyright"><p>© 2019 - 2020 <a href="http://yoursite.com">Kiyamou</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>