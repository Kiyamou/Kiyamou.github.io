<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Travis CI持续集成与各编译器对C++新特性的支持 · 308实验室</title><meta name="description" content="Travis CI持续集成与各编译器对C++新特性的支持 - Kiyamou"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="308实验室"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="308实验室" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/circle.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/Kiyamou" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Travis CI持续集成与各编译器对C++新特性的支持</h1><div class="post-info">Mar 12, 2020</div><div class="post-content"><h3 id="Travis-CI的部署"><a href="#Travis-CI的部署" class="headerlink" title="Travis CI的部署"></a>Travis CI的部署</h3><p>很早就有体验Travis CI持续集成的想法，于是拿<a href="https://github.com/Kiyamou/VapourSynth-JincResize" target="_blank" rel="noopener">VapourSynth-JincResize</a>项目试一试。</p>
<h4 id="依赖问题"><a href="#依赖问题" class="headerlink" title="依赖问题"></a>依赖问题</h4><p>昨天给JincResize项目照猫画虎写了<code>.travis.yml</code>脚本。一开始打算沿用我在Linux下编译的模式，基于meson+ninja构建。为此还专门去搜了Github Issues，从Issues上面抄了使用meson的<code>.travis.yml</code>脚本。</p>
<p>但等我上传了脚本、部署完成之后才想起，JincResize项目使用pkg-config解决依赖的问题，而配置pkg-config需要先编译VapourSynth…在服务器上编译也不是不行，但这样也太脱裤子放屁了…于是我便想不借助构建工具了，直接用gcc编译，反正我的项目结构简单。</p>
<a id="more"></a>

<p>直接用gcc编译也需要解决VapourSynth头文件的依赖，绞尽脑汁想了个略显蛋疼的办法，从VapourSynth的官方仓库中下载头文件到服务器，再移到相应位置。之所以这么折腾，而不是把需要的头文件传到JincResize项目的仓库中，是因为<del>很多其他VapourSynth的Plugin项目都不传这类通用头文件</del>不同版本VapourSynth头文件对应不同版本的VapourSynth API，API版本不同，编译出来的动态链接库没法被VapourSynth主程序调用。如果我自己向仓库传了某一版本的头文件，反而可能误导其他人。</p>
<p>然而VapourSynth毕竟不是一个小项目，起初想试一下git 2.25.0新增的部分克隆功能，只克隆我需要的两个头文件，但我太笨了…不会用。遂用wget下载Release中打包好的源码（体积毕竟比整个仓库小），然后再解压我想要的文件、移动。</p>
<h4 id="编译器版本问题"><a href="#编译器版本问题" class="headerlink" title="编译器版本问题"></a>编译器版本问题</h4><p>Travis CI服务器用的是ubuntu 16 + gcc 5，由于JincResize项目使用了C++17的特殊数学函数（<code>cyl_bessel_j()</code>），需要gcc 7及以上版本。好办，直接给服务器装gcc 7呗。</p>
<p>话是这么说，而且也部署成功并编译通过了，但我总觉得安装gcc 7时要把系统依赖都升级一遍（<code>sudo apt-get upgrade</code>）有点不太环保（<del>虽然Travis CI的服务器性能强劲</del>）。于是改了一下代码，当gcc版本小于7时，用传统的<code>ji()</code>函数，不涉及C++17。</p>
<p>总算环保地在服务器上编译通过了。</p>
<h3 id="各编译器对C-新特性的支持"><a href="#各编译器对C-新特性的支持" class="headerlink" title="各编译器对C++新特性的支持"></a>各编译器对C++新特性的支持</h3></div></article></div></main><footer><div class="paginator"><a href="/2020/03/23/rebuild-JincResize-3/" class="prev">PREV</a><a href="/2020/03/11/build-vapoursynth/" class="next">NEXT</a></div><div class="copyright"><p>© 2019 - 2020 <a href="http://yoursite.com">Kiyamou</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>