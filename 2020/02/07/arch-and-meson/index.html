<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> ArchLinux和Meson构建工具的使用 · 308实验室</title><meta name="description" content="ArchLinux和Meson构建工具的使用 - Kiyamou"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="308实验室"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="308实验室" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/circle.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/Kiyamou" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">ArchLinux和Meson构建工具的使用</h1><div class="post-info">Feb 7, 2020</div><div class="post-content"><h3 id="爱恨交加的CentOS"><a href="#爱恨交加的CentOS" class="headerlink" title="爱恨交加的CentOS"></a>爱恨交加的CentOS</h3><p>我最开始接触的Linux系统是CentOS，因为有sob的讲解，很快上手。CentOS简洁明亮的界面给我留下了很深的好感，也不需要时不时就敲个sudo。从分子动力学和量子化学，到用LaTex写论文，再到学习Caffe，2019年上半年的经历甚至都能用CentOS穿出一条线。</p>
<p>但这次编译VapourSynth着实让我感觉蛋疼。</p>
<a id="more"></a>

<h4 id="编译VapourSynth"><a href="#编译VapourSynth" class="headerlink" title="编译VapourSynth"></a>编译VapourSynth</h4><p>用了这么长时间的Linux，基本的编译套路也该熟悉了。一般开发者都会提供<code>autogen.sh</code>或者<code>configure</code>文件，运行一下。然后<code>make</code>和<code>make install</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> vapoursynth</span><br><span class="line">./autogen.sh</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>在<code>make</code>这一步，编译到<code>exprfilter.cpp</code>这个文件时，出现了一堆报错。我看了一下，<code>exprfilter.cpp</code>应该是针对32bit系统定义了一些常量，报的错是说这些常量没有被声明。</p>
<p>这不是当然的吗？！难道编译器选择性地忽视了<code>#ifndfe CPU_32</code>和<code>#endif</code>…好像还真是，我把被<code>#ifndfe CPU_32</code>和<code>#endif</code>框起来的语句都删除后，就不报错了…</p>
<p>感觉我的编译器是个智障…</p>
<p>然而，继续编译，一个文件名带有<code>avx2</code>字样的cpp文件，编译器干脆连注释都不认识…</p>
<p>搜索了一下，发现有人把GCC编译器从4.8升级到了5.3，就解决了类似不认识<code>#ifndfe</code>的问题。而且升级编译器，也能更好地支持C++的新标准。</p>
<p>我盘算了一下，比起升级编译器，我干脆换个系统吧…之前有人说CentOS的依赖包陈旧，我在装caffe时就感觉到了（有些包需要手动编译新版本，而不能用yum直接装），而这次编译器出问题…emmm我还是尝试一下别的系统吧。</p>
<h3 id="ArchLinux的安装使用"><a href="#ArchLinux的安装使用" class="headerlink" title="ArchLinux的安装使用"></a>ArchLinux的安装使用</h3><p>这个也没啥好说的，虽然ArchLinux在Linux系统下也算是入门门槛较高的了，但教程很详尽，照着做就好。</p>
<p>安装依赖使用<code>pacman -S package</code>，但是不能指定版本，只提供最新版。</p>
<p>说起来，我的转变也是很大的：之前用最小安装的CentOS，只是好玩；现在用没有桌面的ArchLinux，也能完成实际工作了。</p>
<p>因为没有装桌面，只说一下<code>pacman</code>给我的感受。感觉很方便，既不需要想Ubuntu那样没事敲sudo，又不需要担心CentOS提供的包没有更新，也不需要担心CentOS下的包有不一样的名字。</p>
<p>顺便学了/复习了Linux下的常用命令。</p>
<h3 id="Meson与pkg-config的使用"><a href="#Meson与pkg-config的使用" class="headerlink" title="Meson与pkg-config的使用"></a>Meson与pkg-config的使用</h3><h4 id="Meson"><a href="#Meson" class="headerlink" title="Meson"></a>Meson</h4><p>Meson和ninja在ArchLinux下一键安装，基础的cmake、VapourSynth需要的pkg-config，都是一样。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pacman -S cmake</span><br><span class="line">pacman -S meson</span><br><span class="line">pacman -S pkg-config</span><br></pre></td></tr></table></figure>

<p>只是VapourSynth需要版本限定的zimg v2.9，而<code>pacman</code>又只提供最新版。但我试了一下，目前最新版的zimg v2.9.2和VapourSynth R49（这个时候R49还没有发布，但我之后编译好，发现版本号已经改成R49了），至少在编译阶段没有冲突。</p>
<p>目前Meson没什么好说的，因为我现在的项目，还是结构很简单的项目，而且Meson的语法简单明了。只是Meson的教程藏得有点深，推荐去Github上看，<a href="https://github.com/mesonbuild/meson/blob/master/docs/markdown/Reference-manual.md" target="_blank" rel="noopener">https://github.com/mesonbuild/meson/blob/master/docs/markdown/Reference-manual.md</a> 。</p>
<h4 id="pkg-config"><a href="#pkg-config" class="headerlink" title="pkg-config"></a>pkg-config</h4><p>关于pkg-config，我搜了一下，应该和Meson一样，也是一款跨平台的工具…但我觉得，还是只在Linux下用吧…</p>
<p>使用pkg-config的项目要写一个.pc后缀的配置文件，具体到VapourSynth，就是说明了头文件的位置。这个.pc文件会在项目中提供，要自己放到<code>usr/lib/pkgconf</code>下面，然后使用pkg-config时就会到这里搜索。</p>
<p>在我看来，这样避免了每新面对一个项目就重新配环境。</p>
<p>.pc文件也容易读懂，就是通常的配置文件的内容。</p>
<h3 id="在Linux下编译VapourSynth-Plugin"><a href="#在Linux下编译VapourSynth-Plugin" class="headerlink" title="在Linux下编译VapourSynth Plugin"></a>在Linux下编译VapourSynth Plugin</h3><p>上面的准备工作都完成后，两行命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meson build</span><br><span class="line">ninja -C build</span><br></pre></td></tr></table></figure>

<p>即可完成编译，得到期待已久的<code>libxxx.so</code>文件。</p>
<p>今天顺利用上ArchLinux，并确认编译出错源自GCC编译器的陈旧。</p>
<p>成功编译VapourSynth。</p>
<p>成功借助Meson在Linux下编译VapourSynth Plugin。</p>
<p>虽然现在看来不算难事，但在不久的之前，还是困扰我的问题。所以，我的进步是看得见的。</p>
<p>这种扎实的喜悦是一方面。而另一方面，在编译中看着跳动的命令行，感受到计算机内部是怎样运行，而且也不再把红色的Error看得不可解决，这也是感性的成长。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2020/02/07/rebuild-JincResize-2/" class="prev">PREV</a><a href="/2020/02/06/ported-to-vs-3/" class="next">NEXT</a></div><div class="copyright"><p>© 2019 - 2021 <a href="http://yoursite.com">Kiyamou</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>